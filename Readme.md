# Motorway Tweet Converter

This is the 2nd component of the 'Motorway event system'. This component binds to a specific rabbit queue and waits for a condensed tweet. See MotorwayTwitterScraper lib/tweet.py. Once the tweet is recieved this app needs to text mine the contents of this tweet in order to get broken down information. E.g:

```json

{
   "screen_name":"Traffic_M6",
   "created_at":"Wed Oct 17 08:54:13 +0000 2018",
   "id":1052482906797428736,
   "payload":"#M6 northbound between J14 (Stafford (N)) and J15 (Stoke / Newcastle-u-Lyme) - Congestion - Full details at\\u2026 https://t.co/bh6IZOXAOU"
}

```

Will be broken down by the day, time, year, the motorway, the junction, the id, the nearest city, the reason etc.

```json
2018-10-20T21:50:12 [Main] [INFO]: Successfully mined tweet into Event: {
    "closest_cities": [
        "Stafford (N)",
        "Stoke / Newcastle-u-Lyme"
    ],
    "direction": "n",
    "extra_information": [],
    "id": 1052482906797428736,
    "junction": [
        14,
        15
    ],
    "metadata": "Event Generated by Tweet Miner at 2018-10-20T20:50:12.286910",
    "motorway": 6,
    "reason": "congestion",
    "time_day_numerical": 17,
    "time_day_worded": "Wed",
    "time_hour": 8,
    "time_minutes": 54,
    "time_seconds": 13,
    "time_timestamp": "2018-10-17T08:54:13",
    "time_year": 2018
}
```

## Dockerised Application

1. To run this project in docker, Docker needs to be installed.

```
https://docs.docker.com/install/linux/docker-ee/ubuntu/
```

2. Start the docker daemon.

```
systemctl start docker
```

3. Run rabbit-mq. We are going to use containerised rabbit-mq for the purpose of this project. See [Rabbit Broker](https://github.com/SuhailParmar/MotorwayRabbitBroker)


4. Set the config. You can set the config for the application can be set in one of two ways. Either populating the config.py (templated as example_config.py), or setting the environnment variables. Note, the environment variables always take precedents.


5. Create the docker image.

```sh
docker build . -t ${CONTAINER_NAME} # e.g. CONTAINER_NAME=m-tweet-converter
```

6. Run the dockerised application. You will need to specify to docker to run the application on the host network, to allow the containers to communicate through the machines localhost.

```
docker run --network="host" ${CONTAINER_NAME}
```


## Running Locally

1. You will need a configured rabbit server, see [Rabbit Broker](https://github.com/SuhailParmar/MotorwayRabbitBroker)
2. You will need to place your json tweet in the corresponding queue in the rabbit broker or if you're using the [TwitterScraper](https://github.com/SuhailParmar/MotorwayTwitterScraper) run this.
3. To run this application:
```python
python3 main.py
```



## Unit Tests
If you want to run the unit tests for this project you'll need pytest.

```bash
pip3 install pytest
python3 -m pytest -v /tests
```